<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>{{ group.name }} 장소 지도</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />

  <style>
    #map {
      width: 100%;
      height: 500px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<h2>{{ group.name }} 지도</h2>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  // 1. 지도 객체 만들기 (초기 중심은 대략적으로 서울 좌표 같은 걸로 시작 가능)
  const map = L.map('map').setView([37.5665, 126.9780], 13);

  // 2. 배경 타일 (오픈스트리트맵)
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
  }).addTo(map);

  // 3. 그룹의 장소 목록을 서버에서 받아오기
  fetch("{% url 'trip:group_places_json' group_pk=group.pk %}")
    .then(res => res.json())
    .then(places => {
      if (places.length === 0) return;

      // 지도 bounds 계산용
      const bounds = [];

      places.forEach(place => {
        const lat = place.latitude;
        const lng = place.longitude;

        // 4. 마커 찍기
        const marker = L.marker([lat, lng]).addTo(map);

        // 5. 말풍선(popup) 내용
        const popupHtml = `
          <b>${place.name}</b><br/>
          ${place.category ? place.category : ''}<br/>
          (<a href="/places/${place.id}/edit/">Edit</a>)
        `;
        marker.bindPopup(popupHtml);

        bounds.push([lat, lng]);
      });

      // 6. 모든 마커가 보이도록 자동으로 줌/중심 맞추기
      if (bounds.length > 0) {
        map.fitBounds(bounds);
      }
    });
</script>

</body>
</html>
